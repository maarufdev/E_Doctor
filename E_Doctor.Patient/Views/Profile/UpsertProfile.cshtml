@model E_Doctor.Patient.ViewModels.PatientVM.UpsertProfileVM;

@{
    var civilStatOptions = new List<SelectListItem>
    {
        new SelectListItem { Value = "Single", Text = "Single" , Selected = true },
        new SelectListItem { Value = "Married", Text = "Married" },
        new SelectListItem { Value = "Other", Text = "Other" },
    };

    var genderOptions = new List<SelectListItem>
    {
        new SelectListItem { Value = "Male", Text = "Male", Selected = true },
        new SelectListItem { Value = "Female", Text = "Female" },
        new SelectListItem { Value = "Other", Text = "Other" }
    };

    ViewData.TryGetValue("MissingFields", out var MissingFieldsObj);
    string MissingFields = string.Empty;

    if (MissingFieldsObj is not null)
    {
        MissingFields = MissingFieldsObj?.ToString();
    }
}

<link rel="stylesheet" href="~/features/user/css/registration.css" asp-append-version="true" />

<style>
    body {
        overflow-y: hidden;
    }
</style>

<div class="page-content">
    <div class="flex justify-between  mb-4">
        <h2 class="text-2xl font-semibold">Edit Profile</h2>
        <a class="btn btn-primary" asp-action="Index">Back To Profile</a>
    </div>
    <form id="register-form"
          autocomplete="off"
          class="register-form"
          asp-controller="Profile"
          asp-action="UpsertProfile"
          method="POST">

        <div class="register-form-content">

            <div class="registration-form__group">
                <div class="registration-form__group-header">
                    <h3>PERSONAL INFORMATION</h3>
                </div>

                <div class="registration-form__group-field-container mt-2 form-grid">
                    <div class="form-group-field">
                        <label asp-for="LastName">Last Name (*)</label>
                        <input asp-for="LastName" class="form-input" />
                    </div>

                    <div class="form-group-field">
                        <label asp-for="FirstName">First Name (*)</label>
                        <input asp-for="FirstName" class="form-input" />
                    </div>

                    <div class="form-group-field">
                        <label asp-for="MiddleName">Middle Name (*)</label>
                        <input asp-for="MiddleName" class="form-input" />
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-2 form-grid">
                    <div class="form-group-field">
                        <label asp-for="Religion">Religion (*)</label>
                        <input asp-for="Religion" class="form-input" />
                    </div>

                    <div class="form-group-field">
                        <label asp-for="DOB">Date Of Birth (*)</label>
                        <input type="date" asp-for="DOB" class="form-input" />
                    </div>

                    <div class="form-group-field">
                        <label asp-for="CivilStatus">Civil Status (*)</label>
                        <select asp-for="CivilStatus" asp-items="civilStatOptions" class="form-select">
                        </select>
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-2 form-grid">
                    <div class="form-group-field">
                        <label asp-for="Gender">Sex (*)</label>
                        <select asp-for="Gender" asp-items="genderOptions" class="form-select">
                        </select>
                    </div>

                    <div class="form-group-field">
                        <label asp-for="Occupation">Occupation</label>
                        <input asp-for="Occupation" class="form-input" />
                    </div>
                    <div class="form-group-field">
                        <label asp-for="Nationality">Nationality (*)</label>
                        <input asp-for="Nationality" class="form-input" />
                    </div>
                </div>
                <div class="registration-form__group-field-container mt-2 form-grid">
                    <div class="form-group-field">
                        <label asp-for="Address">Address (*)</label>
                        <input asp-for="Address" class="form-input" />
                    </div>
                </div>
            </div>

            <div class="registration-form__group">
                <div class="registration-form__group-header">
                    <h3>PAST MEDICAL RECORD</h3>
                </div>
                <div class="registration-form__group-field-container mt-2 form-grid form-grid-4">
                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-PrevHospitalization"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.PreviousHospitalization" />
                            <label for="past-PrevHospitalization" class="custom-checkbox-label">Previous Hospitalization?</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-Surgery"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.PastSurgery" />
                            <label for="past-Surgery" class="custom-checkbox-label">Past Surgery?</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-Diabetes"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.Diabetes" />
                            <label for="past-Diabetes" class="custom-checkbox-label">Diabetes</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-Hypertension"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.Hypertension" />
                            <label for="past-Hypertension" class="custom-checkbox-label">Hypertension</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-AllergyToMeds"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.AllergyToMeds" />
                            <label for="past-AllergyToMeds" class="custom-checkbox-label">Allergy to Meds</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-HeartProblem"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.AllergyToMeds" />
                            <label for="past-HeartProblem" class="custom-checkbox-label">Heart Problem</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-Asthma"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.Asthma" />
                            <label for="past-Asthma" class="custom-checkbox-label">Asthma</label>
                        </div>
                    </div>

                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-FoodAllergies"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.FoodAllergies" />
                            <label for="past-FoodAllergies" class="custom-checkbox-label">Food Allergies</label>
                        </div>
                    </div>
                </div>
                <div class="registration-form__group-field-container mt-2 form-grid form-grid-3">
                    <div class="form-group-field">
                        <div class="custom-checkbox">
                            <input type="checkbox"
                                   id="past-Cancer"
                                   class="custom-checkbox-input form-checkbox"
                                   asp-for="PastMedicalRecord.Cancer" />
                            <label for="past-Cancer" class="custom-checkbox-label">Cancer</label>
                        </div>
                    </div>

                    <div class="form-group-field grid-span">
                        <label asp-for="PastMedicalRecord.OtherIllnesses">Other Illnesses</label>
                        <input asp-for="PastMedicalRecord.OtherIllnesses" class="form-input" />
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-2">
                    <div class="form-group-field flex flex-column items-start gap-2">
                        <label asp-for="PastMedicalRecord.MaintenanceMeds">Maintenance Medications:</label>
                        <textarea asp-for="PastMedicalRecord.MaintenanceMeds" class="form-input" rows="5"></textarea>
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-2">
                    <div class="form-group-field flex flex-column items-start gap-2">
                        <label asp-for="PastMedicalRecord.OBGyneHistory">OB-GYNE History:</label>
                        <textarea asp-for="PastMedicalRecord.OBGyneHistory" class="form-input" rows="3"></textarea>
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-4">
                    <div class="registration-form__sub-group-field-container flex flex-column gap-2">
                        <div class="flex items-center">
                            <span>Family History:</span>
                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-None"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.None" />
                                <label for="fh-None" class="custom-checkbox-label">None</label>
                            </div>
                        </div>

                        <div class="sub-form-group-field form-grid form-grid-4 w-full family-history-fields-section">

                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-PTB"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.PTB" />
                                <label for="fh-PTB" class="custom-checkbox-label">PTB</label>
                            </div>

                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-Hypertension"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.Hypertension" />
                                <label for="fh-Hypertension" class="custom-checkbox-label">Hypertension</label>
                            </div>

                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-Cardiac"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.Cardiac" />
                                <label for="fh-Cardiac" class="custom-checkbox-label">Cardiac</label>
                            </div>
                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-Diabetes"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.Diabetes" />
                                <label for="fh-Diabetes" class="custom-checkbox-label">Diabetes</label>
                            </div>

                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-Asthma"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.Asthma" />
                                <label for="fh-Asthma" class="custom-checkbox-label">Asthma</label>
                            </div>

                            <div class="custom-checkbox">
                                <input type="checkbox"
                                       id="fh-Cancer"
                                       class="custom-checkbox-input form-checkbox"
                                       asp-for="FamilyHistory.Cancer" />
                                <label for="fh-Cancer" class="custom-checkbox-label">Cancer</label>
                            </div>

                            <div class="form-group-field flex items-center gap-2 grid-span">
                                <label asp-for="FamilyHistory.Others">Others</label>
                                <input asp-for="FamilyHistory.Others" class="form-input" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="registration-form__group-field-container mt-4">
                    <div class="registration-form__sub-group-field-container flex flex-column gap-2">
                        <span>Personal History:</span>
                        <div class="sub-form-group-field form-grid form-grid-4 w-full">
                            <div class="form-group-field">
                                <div class="custom-checkbox">
                                    <input type="checkbox"
                                           id="ph-Smoker"
                                           class="custom-checkbox-input form-checkbox"
                                           asp-for="PersonalHistory.Smoker" />
                                    <label for="ph-Smoker" class="custom-checkbox-label">Smoker</label>
                                </div>
                            </div>

                            <div class="form-group-field">
                                <div class="custom-checkbox">
                                    <input type="checkbox"
                                           id="ph-AlchoholBeverageDrinker"
                                           class="custom-checkbox-input form-checkbox"
                                           asp-for="PersonalHistory.AlchoholBeverageDrinker" />
                                    <label for="ph-AlchoholBeverageDrinker" class="custom-checkbox-label">AlchoholBeverageDrinker</label>
                                </div>
                            </div>

                            <div class="form-group-field">
                                <div class="custom-checkbox">
                                    <input type="checkbox"
                                           id="ph-IllicitDrugUser"
                                           class="custom-checkbox-input form-checkbox"
                                           asp-for="PersonalHistory.IllicitDrugUser" />
                                    <label for="ph-IllicitDrugUser" class="custom-checkbox-label">IllicitDrugUser</label>
                                </div>
                            </div>

                            <div class="form-group-field flex items-center gap-2 w-full">
                                <label asp-for="PersonalHistory.Others">Others</label>
                                <input asp-for="PersonalHistory.Others" class="form-input" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group-buttons">
            <button class="btn btn-primary form-btn-register" >Save Changes</button>
        </div>
    </form>
</div>

@if (!string.IsNullOrWhiteSpace(MissingFields))
{
    <div id="registrationAlert" class="modal-backdrop visible">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="consultation-modal-title" class="text-xl font-semibold">Alert</h3>
                <button id="closeAlertModal" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Following Fields are required:</p>
                <ul>
                    @foreach (var field in MissingFields.Split(", "))
                    {
                        <li>- @field</li>
                    }
                </ul>
            </div>
        </div>
    </div>
}

@if (ViewData.TryGetValue("Error", out var Error))
{
    <div id="registrationAlert" class="modal-backdrop visible">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="consultation-modal-title" class="text-xl font-semibold">Alert</h3>
                <button id="closeAlertModal" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>@(Error != null ? Error.ToString() : "Something Went Wrong")</p>
            </div>
        </div>
    </div>
}

<script>
        document.addEventListener("DOMContentLoaded", () => {
        $("#closeAlertModal").off("click").on("click", function () {
            $("#registrationAlert").removeClass("visible");
        });


        const famHistFields = [...$(`[name^="FamilyHistory."]:not(#fh-None)`)];
        const isDefaultChecked = $("#fh-None").prop("checked");

        famHistFields.forEach(item => {
            if(!isDefaultChecked){
                $(item).removeAttr("disabled");
            } else {
                $(item).attr("disabled", true);
            }
        });


        $("#fh-None").off("change").on("change", function (e) {
            const $this = $(this);
            const isChecked = $this.prop("checked");

            famHistFields.forEach(item => {
                $(item).prop("disabled", isChecked);

                if (isChecked) {
                    $(item).prop("checked", false);
                }

                if ($(item).attr("type") == "text") {
                    $(item).val("");
                }
            });

            console.log(isChecked);
        })
    });

</script>
@* <script src="~/features/patient/profile/js/profile.js" asp-append-version="true"></script> *@